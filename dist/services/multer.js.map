{"version":3,"sources":["../../src/services/multer.js"],"names":["multerSaveTo","fileFilter","req","file","cb","mimetype","ApiError","UnprocessableEntity","folderName","storage","multer","diskStorage","destination","console","log","body","dest","err","filename","fieldname","Date","now","Math","floor","random","path","extname","originalname","limits","fileSize"],"mappings":";;;;;QAWgBA,Y,GAAAA,Y;;AAXhB;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMC,aAAa,SAAbA,UAAa,CAACC,GAAD,EAAMC,IAAN,EAAYC,EAAZ,EAAmB;AAClC,QAAID,KAAKE,QAAL,KAAkB,YAAlB,IAAkCF,KAAKE,QAAL,KAAkB,WAAxD,EAAqE;AACjED,WAAG,IAAH,EAAS,IAAT;AACH,KAFD,MAEOA,GAAG,IAAIE,mBAASC,mBAAb,CAAiC,yCAAjC,CAAH;AACV,CAJD;;AAMO,SAASP,YAAT,CAAsBQ,UAAtB,EAAkC;;AAErC,QAAIC,UAAUC,iBAAOC,WAAP,CAAmB;AAC7BC,qBAAa,qBAAUV,GAAV,EAAeC,IAAf,EAAqBC,EAArB,EAAyB;AAClCS,oBAAQC,GAAR,CAAY,iBAAZ,EAA+BZ,IAAIa,IAAnC;;AAEA,gBAAIC,wBAAsBR,UAA1B;AACA;AACA,kCAAOQ,IAAP,EAAa,UAAUC,GAAV,EAAe;AACxB,oBAAIA,GAAJ,EACI,OAAOb,GAAG,IAAIE,kBAAJ,CAAa,GAAb,EAAkB,sBAAlB,CAAH,CAAP;;AAEJF,mBAAG,IAAH,EAASY,IAAT;AACH,aALD;AAMH,SAZ4B;AAa7BE,kBAAU,kBAAUhB,GAAV,EAAeC,IAAf,EAAqBC,EAArB,EAAyB;AAC/BA,eAAG,IAAH,EAAYD,KAAKgB,SAAjB,UAA8BC,KAAKC,GAAL,KAAaC,KAAKC,KAAL,CAAWD,KAAKE,MAAL,KAAc,KAAzB,CAAb,GAA+CC,eAAKC,OAAL,CAAavB,KAAKwB,YAAlB,CAA7E;AACH;AAf4B,KAAnB,CAAd;;AAkBA,WAAO,sBAAO;AACVlB,wBADU;AAEZ;AACEmB,gBAAQ;AACJC,sBAAU,OAAO,IAAP,GAAc,EADpB,CACuB;AADvB;AAHE,KAAP,CAAP,CAMG;AACN","file":"multer.js","sourcesContent":["import multer from 'multer';\nimport path from 'path';\nimport ApiError from '../helpers/ApiError';\nimport mkdirp from 'mkdirp';\n\nconst fileFilter = (req, file, cb) => {\n    if (file.mimetype === 'image/jpeg' || file.mimetype === 'image/png') {\n        cb(null, true);\n    } else cb(new ApiError.UnprocessableEntity('jpeg or png are the only accepted types'));\n}\n\nexport function multerSaveTo(folderName) {\n\n    let storage = multer.diskStorage({\n        destination: function (req, file, cb) {\n            console.log(\"BODY iN DEST : \", req.body);\n\n            let dest = `src/uploads/${folderName}`;\n            // create destination if don't exist\n            mkdirp(dest, function (err) {\n                if (err)\n                    return cb(new ApiError(500, \"Couldn't create dest\"))\n\n                cb(null, dest)\n            });\n        },\n        filename: function (req, file, cb) {\n            cb(null, `${file.fieldname}-${Date.now() + Math.floor(Math.random()*10000) + path.extname(file.originalname)}`);\n        }\n    });\n\n    return multer({\n        storage,\n      //  fileFilter,\n        limits: {\n            fileSize: 1024 * 1024 * 10 // limit 10mb\n        }\n    });;\n}\n"]}