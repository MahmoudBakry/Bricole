{"version":3,"sources":["../../src/services/passport.js"],"names":["JwtStrategy","passportJwt","Strategy","LocalStrategy","passportLocal","ExtractJwt","jwtSecret","config","passport","use","jwtFromRequest","fromAuthHeaderAsBearerToken","secretOrKey","payload","done","User","findById","sub","then","user","catch","console","log","err","usernameField","phone","password","findOne","isValidPassword","isMatch","error"],"mappings":";;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,cAAcC,sBAAYC,QAAhC;AACA,IAAMC,gBAAgBC,wBAAcF,QAApC;IACQG,U,GAAeJ,qB,CAAfI,U;IACAC,S,GAAcC,gB,CAAdD,S;;;AAGRE,mBAASC,GAAT,CAAa,IAAIT,WAAJ,CAAgB;AACzBU,oBAAgBL,WAAWM,2BAAX,EADS;AAEzBC,iBAAaN;AAFY,CAAhB,EAGV,UAACO,OAAD,EAAUC,IAAV,EAAmB;AAClB;AACAC,mBAAKC,QAAL,CAAcH,QAAQI,GAAtB,EAA2BC,IAA3B,CAAgC,gBAAQ;AACpC,YAAI,CAACC,IAAL,EACI,OAAOL,KAAK,IAAL,EAAW,KAAX,CAAP;;AAEJ,eAAOA,KAAK,IAAL,EAAWK,IAAX,CAAP;AACH,KALD,EAKGC,KALH,CAKS,eAAO;AACZC,gBAAQC,GAAR,CAAY,kBAAZ,EAAgCC,GAAhC;AACAT,aAAK,IAAL,EAAW,KAAX;AACH,KARD;AASH,CAdY,CAAb;;AAiBAN,mBAASC,GAAT,CAAa,IAAIN,aAAJ,CAAkB;AAC3BqB,mBAAe;AADY,CAAlB,EAEV,UAACC,KAAD,EAAQC,QAAR,EAAkBZ,IAAlB,EAA2B;AAC1BC,mBAAKY,OAAL,CAAa,EAAEF,YAAF,EAAb,EAAwBP,IAAxB,CAA6B,gBAAQ;AACjC,YAAI,CAACC,IAAL,EACI,OAAOL,KAAK,IAAL,EAAW,KAAX,CAAP;;AAEJ;AACAK,aAAKS,eAAL,CAAqBF,QAArB,EAA+B,UAAUH,GAAV,EAAeM,OAAf,EAAwB;AACnD,gBAAIN,GAAJ,EAAS,OAAOT,KAAKS,GAAL,CAAP;AACT,gBAAI,CAACM,OAAL,EAAc,OAAOf,KAAK,IAAL,EAAW,KAAX,EAAkB,EAAEgB,OAAO,qBAAT,EAAlB,CAAP;;AAEd,mBAAOhB,KAAK,IAAL,EAAWK,IAAX,CAAP;AACH,SALD;AAOH,KAZD;AAaH,CAhBY,CAAb","file":"passport.js","sourcesContent":["\nimport passport from \"passport\";\nimport passportJwt from \"passport-jwt\";\nimport passportLocal from \"passport-local\";\nimport config from \"../config\";\nimport User from \"../models/user.model\";\n\nconst JwtStrategy = passportJwt.Strategy;\nconst LocalStrategy = passportLocal.Strategy;\nconst { ExtractJwt } = passportJwt;\nconst { jwtSecret } = config;\n\n\npassport.use(new JwtStrategy({\n    jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\n    secretOrKey: jwtSecret\n}, (payload, done) => {\n    // find user in token\n    User.findById(payload.sub).then(user => {\n        if (!user)\n            return done(null, false);\n\n        return done(null, user)\n    }).catch(err => {\n        console.log('Passport Error: ', err);\n        done(null, false);\n    })\n}));\n\n\npassport.use(new LocalStrategy({\n    usernameField: 'phone'\n}, (phone, password, done) => {\n    User.findOne({ phone }).then(user => {\n        if (!user)\n            return done(null, false);\n\n        // Compare Passwords \n        user.isValidPassword(password, function (err, isMatch) {\n            if (err) return done(err);\n            if (!isMatch) return done(null, false, { error: 'Invalid Credentials' });\n\n            return done(null, user);\n        })\n\n    });\n}));"]}