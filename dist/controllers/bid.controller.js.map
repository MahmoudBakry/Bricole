{"version":3,"sources":["../../src/controllers/bid.controller.js"],"names":["validateBody","validations","exists","withMessage","createNewBid","req","res","next","validationErrors","array","length","ApiError","bricolId","params","body","bricol","Bid","create","newBid","status","json","retriveAllBidsForBricol","limit","parseInt","query","page","find","populate","skip","sort","creationDate","allDocs","count","send","ApiResponse","Math","ceil","countNumberOfBidToONeBricol","Bricol","findById","bricolDetails","end"],"mappings":"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","file":"bid.controller.js","sourcesContent":["import Bid from '../models/bid.model';\nimport Bricol from '../models/bricole.model';\nimport mongoose from 'mongoose';\nimport ApiResponse from '../helpers/ApiResponse';\nimport ApiError from '../helpers/ApiError';\nimport { body, param, validationResult } from 'express-validator/check';\n\nexport default {\n\n    //validation for create new bid\n    validateBody() {\n        let validations = [\n            body(\"cost\").exists().withMessage(\"cost is required\"),\n            body(\"user\").exists().withMessage(\"user is required\"),\n            body('offerDescription').exists().withMessage(\"offerDescription  is required\"),\n            body(\"cost\").exists().withMessage(\"cost is required\"),\n        ];\n        return validations;\n    },\n\n    //create new Bid for specific bricol \n    async createNewBid(req, res, next) {\n        try {\n            const validationErrors = validationResult(req).array();\n            if (validationErrors.length > 0)\n                return next(new ApiError(422, validationErrors));\n\n            let bricolId = req.params.bricolId;\n            req.body.bricol = bricolId;\n            let newBid = await Bid.create(req.body);\n            return res.status(201).json(newBid);\n        } catch (err) {\n            next(err)\n        }\n    },\n\n    //retrive all Bid for one Bricol \n    async retriveAllBidsForBricol(req, res, next) {\n        try {\n            const limit = parseInt(req.query.limit) || 20;\n            const page = req.query.page || 1;\n            let bricolId = req.params.bricolId;\n            let allDocs = await Bid.find({ bricol: bricolId })\n                .populate('user')\n                .populate('bricol').skip((page - 1) * limit)\n                .limit(limit).sort({ creationDate: -1 })\n            let count = await Bid.count({ bricol: bricolId });\n\n            return res.send(new ApiResponse(\n                allDocs,\n                page,\n                Math.ceil(count / limit),\n                limit,\n                count,\n                req\n            ))\n\n        } catch (err) {\n            next(err)\n        }\n    },\n\n    //count number of bids to specific bricol\n    async countNumberOfBidToONeBricol(req, res, next) {\n        try {\n            let bricolId = req.params.bricolId;\n            let bricolDetails = await Bricol.findById(bricolId);\n            if (!bricolDetails)\n                return res.status(404).end();\n            let count = await Bid.count({ bricol: bricolId })\n            return res.status(200).json({count});\n        } catch (err) {\n            next(err)\n        }\n    },\n\n}\n\n\n"]}